#include <pspsdk.h>
#include <string.h>

static u8 specialRequest[0x40] = {
	0x59, 0xAD, 0x29, 0xD3, 0xE6, 0x62, 0x79, 0xF1,
  0xAF, 0x53, 0x2C, 0x62, 0x79, 0x92, 0xDE, 0xCB,
  0x56, 0xA8, 0xB9, 0x9C, 0x68, 0xA5, 0x09, 0x58,
	0x18, 0xF3, 0x52, 0xDC, 0x9B, 0xC7, 0xFB, 0x8F,
  0x3D, 0x43, 0x70, 0x7D, 0x2F, 0xBB, 0x72, 0x3C,
  0x12, 0x36, 0x0C, 0x8E, 0x81, 0xBE, 0x03, 0x1E,
	0x01, 0x2F, 0x20, 0xD2, 0x68, 0xDA, 0x7C, 0xCD,
  0x20, 0x21, 0xD5, 0x56, 0x0F, 0xE6, 0x27, 0x02
};

static int sceKermitSpecialRequest(void) {
  memcpy((void *)0xBFC00FC0, specialRequest, sizeof(specialRequest));

  *(volatile u32 *)0xABD78000 = 1;
  while (*(volatile u32 *)0xABD78000 != 2);
  *(volatile u32 *)0xABD78000 = 3;
  while (*(volatile u32 *)0xABD78000 != 0);

  memset((void *)0xBFC00FC0, 0, sizeof(specialRequest));

  return 0;
}

int main(void) {
  *(volatile u32 *)0xBC000000 = 0xcccccccc;
  *(volatile u32 *)0xBC000004 = 0xcccccccc;
  *(volatile u32 *)0xBC000008 = 0xcccccccc;
  *(volatile u32 *)0xBC00000c = 0xcccccccc;
  *(volatile u32 *)0xBC000030 = 0;
  *(volatile u32 *)0xBC000034 = 0;
  *(volatile u32 *)0xBC000038 = 0;
  *(volatile u32 *)0xBC00003c = 0;
  *(volatile u32 *)0xBC000040 = 0;
  *(volatile u32 *)0xBC000044 &= 0xffffff9f;
  *(volatile u32 *)0xBC100040 |= 2;
  __asm__ volatile ("sync");
  *(volatile u32 *)0xBC100050 |= 0x4080;

  sceKermitSpecialRequest();

  while (1) {
    (*(volatile u32 *)0xA8000000)++;
  }

  return 0;
}
